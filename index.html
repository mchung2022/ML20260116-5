<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>高中教室點名與座位表產生器</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --absent-color: #e74c3c;
            --late-color: #f39c12;
            --present-color: #2ecc71;
            --bg-color: #f4f7f6;
        }

        body {
            font-family: "Microsoft JhengHei", Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: var(--primary-color);
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 10px;
        }

        .config-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 5px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: bold;
            margin-bottom: 5px;
        }

        textarea, input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .button-group {
            grid-column: span 2;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }

        .btn-generate { background-color: var(--secondary-color); color: white; }
        .btn-random { background-color: #9b59b6; color: white; }
        .btn-print { background-color: #27ae60; color: white; }
        button:hover { opacity: 0.8; }

        /* 座位表樣式 */
        .classroom-stage {
            text-align: center;
            background: #ddd;
            margin: 20px auto;
            padding: 10px;
            width: 60%;
            font-weight: bold;
            border-radius: 5px;
        }

        .seating-chart {
            display: grid;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
            overflow-x: auto;
        }

        .seat {
            width: 100px;
            height: 80px;
            border: 2px solid #bdc3c7;
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: white;
            cursor: pointer;
            user-select: none;
            position: relative;
            font-size: 14px;
        }

        .seat.empty {
            border: 1px dashed #ccc;
            background: transparent;
        }

        .seat.present { border-color: var(--present-color); background-color: #eafaf1; }
        .seat.absent { border-color: var(--absent-color); background-color: #fdedec; }
        .seat.late { border-color: var(--late-color); background-color: #fef9e7; }

        .status-badge {
            font-size: 10px;
            margin-top: 5px;
            padding: 2px 5px;
            border-radius: 3px;
        }

        .stat-panel {
            margin-top: 20px;
            padding: 15px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-around;
            font-weight: bold;
        }

        /* 列印優化 */
        @media print {
            .config-panel, .button-group { display: none !important; }
            .container { box-shadow: none; border: none; }
            .seat { -webkit-print-color-adjust: exact; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>高中點名與座位產生器</h1>

    <div class="config-panel">
        <div class="input-group">
            <label>學生名單 (用逗號或換行分隔)</label>
            <textarea id="studentNames" rows="5" placeholder="例如：王小明, 李小華, 張大同...">王小明, 李小華, 張大同, 陳美玲, 林志穎, 趙又廷, 周杰倫, 蔡依林, 郭雪芙, 羅志祥, 許瑋甯, 彭于晏</textarea>
        </div>
        <div class="input-group">
            <label>教室配置 (行 x 列)</label>
            <div style="display:flex; gap:10px;">
                <input type="number" id="rows" value="4" min="1" style="width:60px;"> 行 (Rows)
                <input type="number" id="cols" value="4" min="1" style="width:60px;"> 列 (Cols)
            </div>
            <p style="font-size: 12px; color: #666;">* 點擊座位可切換點名狀態：到校 → 缺席 → 遲到</p>
        </div>

        <div class="button-group">
            <button class="btn-generate" onclick="generateChart(false)">依序產生座位</button>
            <button class="btn-random" onclick="generateChart(true)">隨機打亂座位</button>
            <button class="btn-print" onclick="window.print()">列印/儲存PDF</button>
        </div>
    </div>

    <div class="classroom-stage">講台 / 黑板</div>
    
    <div id="seatingChart" class="seating-chart">
        <!-- 座位將生成在此 -->
    </div>

    <div class="stat-panel">
        <span>總人數：<span id="totalCount">0</span></span>
        <span style="color:var(--present-color)">到校：<span id="presentCount">0</span></span>
        <span style="color:var(--absent-color)">缺席：<span id="absentCount">0</span></span>
        <span style="color:var(--late-color)">遲到：<span id="lateCount">0</span></span>
    </div>
</div>

<script>
    let attendanceData = [];

    function generateChart(isRandom) {
        const nameInput = document.getElementById('studentNames').value;
        let names = nameInput.split(/[,\n，]/).map(n => n.trim()).filter(n => n !== "");
        
        const rows = parseInt(document.getElementById('rows').value);
        const cols = parseInt(document.getElementById('cols').value);
        const chart = document.getElementById('seatingChart');

        if (isRandom) {
            names = names.sort(() => Math.random() - 0.5);
        }

        // 清空容器
        chart.innerHTML = '';
        chart.style.gridTemplateColumns = `repeat(${cols}, 100px)`;
        
        attendanceData = [];
        let nameIndex = 0;

        for (let i = 0; i < rows * cols; i++) {
            const seat = document.createElement('div');
            seat.className = 'seat';
            
            if (nameIndex < names.length) {
                const name = names[nameIndex];
                seat.innerHTML = `
                    <div style="font-weight:bold">${name}</div>
                    <div class="status-badge" id="status-${i}">到校</div>
                `;
                seat.dataset.status = 'present';
                seat.classList.add('present');
                
                seat.onclick = function() {
                    toggleAttendance(this, i);
                };
                nameIndex++;
            } else {
                seat.classList.add('empty');
                seat.innerText = '空位';
            }
            
            chart.appendChild(seat);
        }
        
        updateStats();
    }

    function toggleAttendance(seatElem, index) {
        const statusBadge = document.getElementById(`status-${index}`);
        const currentStatus = seatElem.dataset.status;

        if (currentStatus === 'present') {
            seatElem.dataset.status = 'absent';
            seatElem.classList.remove('present');
            seatElem.classList.add('absent');
            statusBadge.innerText = '缺席';
        } else if (currentStatus === 'absent') {
            seatElem.dataset.status = 'late';
            seatElem.classList.remove('absent');
            seatElem.classList.add('late');
            statusBadge.innerText = '遲到';
        } else {
            seatElem.dataset.status = 'present';
            seatElem.classList.remove('late');
            seatElem.classList.add('present');
            statusBadge.innerText = '到校';
        }
        updateStats();
    }

    function updateStats() {
        const seats = document.querySelectorAll('.seat:not(.empty)');
        let total = seats.length;
        let present = 0;
        let absent = 0;
        let late = 0;

        seats.forEach(s => {
            if (s.dataset.status === 'present') present++;
            if (s.dataset.status === 'absent') absent++;
            if (s.dataset.status === 'late') late++;
        });

        document.getElementById('totalCount').innerText = total;
        document.getElementById('presentCount').innerText = present;
        document.getElementById('absentCount').innerText = absent;
        document.getElementById('lateCount').innerText = late;
    }

    // 初始化
    generateChart(false);
</script>

</body>
</html>
